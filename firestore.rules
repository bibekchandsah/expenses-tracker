rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Users can only access their own data
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;

      // Profile
      match /profile/{doc} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }

      // Expenses
      match /expenses/{expenseId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;

        // Validate expense data on write
        allow create, update: if request.auth != null
          && request.auth.uid == userId
          && request.resource.data.title is string
          && request.resource.data.title.size() > 0
          && request.resource.data.amount is number
          && request.resource.data.amount > 0
          && request.resource.data.category is string;
      }

      // Categories
      match /categories/{categoryId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }

      // Budgets
      match /budgets/{budgetId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }

      // Lends
      match /lends/{lendId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }

      // Loans
      match /loans/{loanId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }

      // Savings
      match /savings/{savingId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }

      // Saving Sources
      match /savingSources/{sourceId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }

      // For Me
      match /forMe/{entryId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }

      // Notes
      match /notes/{noteId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }

      // Incomes
      match /incomes/{incomeId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }

      // Banks
      match /banks/{bankId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;

        // Bank entries (transactions)
        match /entries/{entryId} {
          allow read, write: if request.auth != null && request.auth.uid == userId;
        }
      }
    }

    // Deny all other access
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
